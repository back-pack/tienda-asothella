{% extends 'base.html.twig' %}

{% block title %} Agregar item {% endblock %}

{% block body %}

<div class="container">
    {{ form_start(form, {'attr': {'class': 'form-horizontal', 'novalidate': 'novalidate'}})}}
    <h1>{{ product.name }}</h1>
    <div id="products">
    {% if form.company is defined %}
        <label>Empresa: </label>{{ form_widget(form.company)}}
    {% endif %}
        <label>Cantidad:</label>{{ form_widget(form.quantity, {'attr': { 'onchange': 'setCost(0)' }})}}
        <label>Costo:</label>{{ form_widget(form.cost) }}
    {% if product.isColor %}
        <label>Color:</label>{{ form_widget(form.colour) }}
        <div class="col-xs-10 col-sm-7">
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#picker-1" aria-expanded="true">Catalogo</a></li>
                <li class=""><a data-toggle="tab" href="#picker-2" aria-expanded="false">Custom</a></li>
                <li class=""><a data-toggle="tab" href="#picker-3" aria-expanded="false">Sin color</a></li>
            </ul>
            <div class="color_picker tab-content">
                <div id="picker-1" class="tab-pane fade active in">
                    <div class="col-xs-12">
                        <h5>Estos son los colores de catalogo.Entrega 48hs</h5>
                    </div>
                    <div class="col-xs-12">
                        <div class="cc-selector">
                            <input id="colonial_std_1" type="radio" name="credit-card" value="colonial_std_1">
                            <label class="drinkcard-cc colonial_std_1" for="colonial_std_1"><h4 class="color_number">Blanco</h4></label>
                            <input id="colonial_std_2" type="radio" name="credit-card" value="colonial_std_2">
                            <label class="drinkcard-cc colonial_std_2" for="colonial_std_2"><h4 class="color_number">Azul YPF</h4></label>
                            <input id="colonial_std_3" type="radio" name="credit-card" value="colonial_std_3">
                            <label class="drinkcard-cc colonial_std_3" for="colonial_std_3"><h4 class="color_number">Verde Ingles</h4></label>
                            <input id="colonial_std_4" type="radio" name="credit-card" value="colonial_std_4">
                            <label class="drinkcard-cc colonial_std_4" for="colonial_std_4"><h4 class="color_number">Rojo Teja</h4></label>
                            <input id="colonial_std_5" type="radio" name="credit-card" value="colonial_std_5">
                            <label class="drinkcard-cc colonial_std_5" for="colonial_std_5"><h4 class="color_number">Negro Semimate</h4></label>
                            <input id="colonial_std_6" type="radio" name="credit-card" value="colonial_std_6">
                            <label class="drinkcard-cc colonial_std_6" for="colonial_std_6"><h4 class="color_number">Gris</h4></label>
                        </div>
                    </div>
                </div>
                <div id="picker-2" class="tab-pane fade">
                    <div class="row">
                        <div class="col-xs-2">
                            <h5>Seleccione su color favorito</h5>
                            <h5><input type="color"></h5>
                        </div>
                        <div class="col-xs-10">
                            <div class="color_teja_custom h5" style="background-image: linear-gradient(to right, #bd4b03,#bd4b03), url('./img/teja_color_custom.png') "></div>
                            
                        </div>
                    </div>
                </div>
                <div id="picker-3" class="tab-pane fade">
                    <h5>Sin color.</h5>
                </div>                            
            </div>
        </div>
    {% endif %}
    </div>
    
    <br>
    <div class="row">
        <button class="btn">{{ button_label|default('Agregar item') }}</button>
    </div>
    {{ form_end(form)}}
    
</div>
        <script src="{{ asset('js/jquery.colorPicker.js') }}" type="text/javascript"></script>
        <script>
            var index = document.getElementById("index").innerHTML;
            var products = document.querySelectorAll('#products div');
            
            console.log(products);

            jQuery(document).ready(function($) {
                $('#product_request_colour').colorPicker();
                
                $('#addProduct').click(() => {
                    index = parseInt(index);
                    index = index + 1;
                    
                    var divRow = document.createElement('div');
                    divRow.className = 'row';
                    divRow.id = "product" + index;

                    divRow.appendChild(createTypeElement(index));
                    divRow.appendChild(createQuantityElement(index));
                    divRow.appendChild(createCostElement(index));
                    divRow.appendChild(createColorElement(index));
                    divRow.appendChild(createRemoveButton(index));
                    $("#products").append(divRow);
                    
                })

                function createColorElement(index) {
                    var newInput = document.createElement('input');
                    newInput.setAttribute('required' , 'required');
                    newInput.id = 'requirement_productRequests_'+index+'_colour';
                    newInput.name = 'requirement[productRequests]['+index+'][colour]';

                    return newInput;
                }

                function createCostElement(index) {
                    var newInput = document.createElement('input');
                    newInput.setAttribute('required', 'required');
                    newInput.setAttribute('readonly', 'readonly');
                    newInput.id = 'requirement_productRequests_'+index+'_cost';
                    newInput.name = 'requirement[productRequests]['+index+'][cost]';

                    return newInput;
                }

                function createQuantityElement(index) {
                    var newInput = document.createElement('input');
                    newInput.setAttribute('required' , 'required');
                    newInput.id = 'requirement_productRequests_'+index+'_quantity';
                    newInput.name = 'requirement[productRequests]['+index+'][quantity]';
                    newInput.setAttribute("onchange", "setCost("+index+");");
                    return newInput;
                }

                function createTypeElement(index) {
                    var select = document.createElement('select');
                    select.name = "requirement[productRequests]["+ index +"][type]";
                    select.id = "requirement_productRequests_"+ index +"_type";
                    select.setAttribute("onchange", "setCost("+index+")");

                    var modelSelect = document.getElementById("requirement_productRequests_0_type");
                    for(var i = 0; i < modelSelect.options.length; i++) {
                        var opt = document.createElement('option');
                        opt.text = modelSelect.options[i].text;
                        opt.value = modelSelect.options[i].value;
                        select.add(opt, select[i]);
                    }
                    return select;
                }

                function createRemoveButton(index) {
                    var button = document.createElement('a');
                    button.setAttribute("onclick", "removeProduct("+index+");");
                    button.className = "btn btn-danger";
                    button.innerHTML = "Quitar"

                    return button;
                }
                
            });
            function removeProduct(index) {
                var product = document.getElementById("product"+index);
                product.remove();
            }
            function setCost(index) {
                var cost = document.getElementById("requirement_productRequests_"+index+"_cost").value;
                var quantityValue = document.getElementById("requirement_productRequests_"+index+"_quantity").value;
                var selectedTile = document.getElementById("requirement_productRequests_"+index+"_type").value;

                if(quantityValue == '' || quantityValue == undefined) {
                    return;
                }
                
                cost = parseInt(quantityValue) * parseFloat(selectedTile);
            }

            
        </script>

{% endblock %}
